# fog-algorithm

### Туман - стеганографический алгоритм для _относительно безопасного_ хранения сид фраз в незащищенных местах, таких как: Гугл и прочие диски, почта, распечатки на бумаге и т.д.

> Приведенный ниже способ не является алгоритмом шифрования. Это возможность хранить сид-фразу относительно безопасно и не запоминать ее. Используйте на свой страх и риск.

Полученный по алгоритму набор слов можно распечатать на бумаге, закинуть на почту и т.д. 
Вам не потребуется программа для восстановления фразы, если вы понимаете, как работает алгоритм и помните пин-код.
Получить ключ по пин-коду можно даже в табличке excel или вообще на бумажке.


#### Описание работы алгоритма.

Пин-код используемый в этом примере - 12345.

Сид фраза, которую мы собираемся положить в публичном месте после замешивания в туман, состоит из 12 слов.
Для наглядности в примере работы алгоритма будем использовать цифры вместо настоящих слов.
1 2 3 4 5 6 7 8 9 10 11 12

Генерировать первичный туман лучше всего случайно.
Рекомендую использовать библиотеку bip39gen (_Python_).
<https://github.com/massmux/bip39gen>

#### Создаем первичный туман из случайных слов с помощью bip39gen

```python
import bip39gen as bip
import random
def random_fog() -> list:
  words_count = 300
  fog = bip.random_as_string(words_count, separator=" ", lang="en")
  return fog.split()
print(random_fog())
```


##### Исходный ключ
Образуется склеиванием пин-кода с самим собой до получения длины равной кол-ву слов в сид фразе.
В этом пример длина пин-кода 5 символов. Поэтому мы _добиваем_ еще 7 символов из начала пин-кода к его концу.
Таким образом первичный ключ тумана 123451234512, всего 12 символов.

##### Первичный ключ
Для получения первичного ключа надо проделать операцию с каждым элементом исходного ключа:

каждую цифру исходного ключа имеющую нечетный индекс складываем с индексом умноженным на 10.

каждую цифру исходного ключа имеющую четный индекс возводим в квадрат.

##### XOR ключ
Для получения XOR ключа надо произвести xor операцию: индекс первичного ключа (считать от 1) xor значение первичного ключа от этого индекса.

В MS Excel эта операция назвается БИТ.ИСКЛИЛИ(A;B)

##### Контрольное число XOR ключа
Это число понадобится на последнем шаге. Вычисляется как остаток от деления суммы всех элементов XOR ключа на кол-во его элементов.

##### Ключ сдвига
Это последний шаг подготовки, который выполняется так:

для четного индекса XOR ключа берется его значение, складывается со значением из соответствующего индекса первичного ключа и с контрольным XOR числом

для нечетного индекса XOR ключа берется его значение, складывается со значением из соответствующего индекса первичного ключа и вычитается контрольное XOR число


Все преобразования показаны в таблице. Контрольное число XOR ключа в данном случае равно 11.

|   Индекс	    |   1	|   2	|   3	|   4	|   5	|   6	|   7	|   8	|   9	|   10	|   11	|   12	|
|---	        |---	|---	|---	|---	|---	|---	|---	|---	|---	|---	|---	|---	|
|Пин-код        |   1 	|   2	|   3	|   4	|   5	|   1	|   2	|   3	|   4	|   5	|   1	|   2	|
|Первичный ключ |   1	|  22	|   9	|   44	|   25	|   61	|   4	|   83	|   16	|   105	|   1	|   122	|
|XOR         	|   0   |  20 	|  10 	|   40	|   28	|   59	|   3	|   91	|   25	|   99	|   10	|  118 	|
|Сдвиг  	    |   12	|  31 	|  30 	|   74	|   64	|   109	|   18	|   163	|   52	|   193	|   22	|  229 	|

Вы также можете провести эксперименты с разыми значениями пин-кода в с помощью файла keys_calculator.xlsx 


Теперь у нас есть сдвиг для каждого слова из сид фразы.

#### Создание публичного тумана
_Для генерации тумана лучше использовать программу, ибо делать это руками будет достаточно неудобно)_
После генерации первичного тумана из случайных слов (выше), записываем нашу сид фразу в туман таким образом:
1. Преобразуем первичный туман в список (_для Pyhon_)
2. Берем последний символ ключа тумана (_обратный цикл_). Его индекс 12, а значение сдвига 229.
3. Берем из сид фразы слово стоящее под номером 12 и добавляем его в туман с индексом 229.
4. Туман увеличивается на одно слово, а индексы тумана смещаются на единицу.
5. Повторяем шаги 3-4 до перебора всей длины ключа.
6. Таким образом, полученный список увеличится на 12 слов.
7. Преобразуем список в строку и полученный набор слов можно распечать, сохранить на компьютере и т.д.



#### Туман, после полного прохода по все фразе
`
exchange repair glass visa vintage refuse all enlist flip size puppy number 1 earth 
empower food foam account believe 7 panel success guitar smile 11 turn close begin 
pen cake canyon 3 2 fresh quit bleak tattoo sorry weasel melody mistake clay wasp 
unfair sugar push vague tornado guilt dragon brick choose vapor chest average slight 
9 maximum film sound venture process room beef solve rain bitter 5 stomach universe 
eyebrow deputy excuse walk muscle shed 4 burden gather shallow fuel protect ozone 
sunset organ fun dad giggle latin life empty office uphold lottery pledge aspect 
capital once retire nose remove poverty depth nominee puppy index absurd found pen 
into enlist shrug leave slush 6 age sea liar dismiss tank sand dumb indicate then 
abuse cereal broom buzz conduct tone grass blush cousin bubble parade march fantasy 
girl nerve heart false tree tobacco tonight local antique rough pizza message lock 
behind sand mail leaf canal stairs globe phone canyon valid disorder wish try behave 
law tunnel gather cannon engage hub 8 problem flee walk hundred gain symbol kick 
drama enroll cousin lobster nose young suspect account visual market great cliff 
double brisk puzzle hand mass canoe roast spoil useful chair deer vibrant 10 
spring keen crush width ozone brisk live alley sketch suggest oblige crowd live 
sight idle must swap attract market essence repair deer wrap nothing govern mango 
pull truth lazy ball face daring piano album stand goddess tent 12 field panda comic 
solar club void never crowd shine margin illegal transfer pottery subway glad cage enjoy
`

#### Восстановление сид фразы из тумана достаточно просто выполнить без компьютера
Теперь цикл уже прямой.
1. Создаем пустой список для записи слов из тумана.
2. Преобразуем строку тумана в список (_для Python_)
3. Создаем все ключи по пин-коду
4. Берем нулевой индекс ключа. Это 1.
5. Добавляем слово из туманного списка с индексом 1 + 1 (сдвиг) в список слов. Это первое слово из сид фразы.
6. Из туманного списка удаляется элемент с индексом 1. Туман слов укорачивается, индексы смещаются.
7. Шаги 3-5 повторяются до перебора всей длины ключа.

Как видно, все операции по расчету ключа из пин-кода несложно сделать вручную или например в excel.
Также можно восстановить фразу с бумажного листка, просто вычеркивая найденные по ключу и сдвигу слова и считая индекс от нуля каждый раз для следующего слова.

#### Несколько слов о безопасности

__Это не криптографический алгоритм и не способ шифрования инофрмации!!! Это алгоритм стеганографии!!!__

В работе алгоритма нет никаких криптографических методов. Это способ скрыть информацию в другой информации. Суть данного способа в том, что правильный порядок слов и их место в конечном тексте
находятся в неизвестных местах, среди других слов. Сами слова ключевой фразы все равно присутствуют в получаемом тексте.

Смысл алгоритма туман - получить способ восстанавливать забытую, либо утерянную ключевую фразу из относительно безопасного места хранения в тумане, без применения каких-либо программ вообще.

В качестве дополнительного способа защиты можно увеличить ключевую фразу, которую вы хотите спрятать, за счет добавления слов в ее начало, середину, конец и т.д.

Например:

фразу truck token kiwi two riot orient group skirt loud mass version guard, можно изменить так:

start truck token kiwi two riot orient middle group skirt loud mass version guard finish

Мы добавляем start, middle, finish к сид фразе и увеличиваем таким образом  ее длину с 12 до 15 слов. Их разброс по тексту изменится соответственно.

__Никогда не генерируйте и не публикуйте разные версии тумана с одним пин-кодом!!!__

Это серьезно снижает безопасность способа, так как обладая даже двумя вариантами текста, можно будет легко вычислить какие слова не меняют свой порядок в нем.
Разумеется в этом случае все еще остается неизвестным правильный порядок слов, но данный факт не должен вас обнадеживать.

__Пин-код должен соответствовать всем требованиям безопасности. Не указывайте свой день рождения, дни рождения детей, жен и прочие даты. 
Не указывайте в качестве пин-кода свой номер телефона или номер автомобиля.__


