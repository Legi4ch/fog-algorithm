# fog-algorithm

### Алгоритм Туман для _относительно безопасного_ публичного хранения сид фраз в открытых местах, таких как: Гугл и прочие диски, почта, распечатки на бумаге и т.д.

> Приведенный ниже способ не является устойчивым алгоритмом шифрования. Это возможность хранить сид-фразу относительно безопасно и не запоминать ее. Используйте на свой страх и риск.

Полученный по алгоритму набор слов можно распечатать на бумаге, закинуть на почту и т.д. 
Вам не потребуется программа для восстановления фразы, если вы понимаете, как работает алгоритм и помните пин-код.
Получить ключ по пин-коду можно даже в табличке excel или вообще на бумажке.


#### Описание работы алгоритма.

Пин-код используемый в этом примере - 123456.

Сид фраза из 12 слов, которую мы собираемся положить в публичном месте после замешивания в туман.
Для наглядности будем использовать цифры вместо слов.
1 2 3 4 5 6 7 8 9 10 11 12

Генерировать первичный туман лучше всего случайно.
Рекомендую использовать библиотеку bip39gen (_Python_).
<https://github.com/massmux/bip39gen>

#### Создаем первичный туман из случайных слов
`
['mystery', 'base', 'lens', 'smile', 'amazing', 'limit', 'offer', 'column', 'habit', 'art', 'height', 'august', 'emerge', 'merge', 'globe', 'rely', 'boy', 'fan', 'rubber', 'mask', 'salon', 'village', 'lobster', 'physical', 'carbon', 'day', 'tool', 'abuse', 'cruise', 'margin', 'sausage', 'victory', 'open', 'monster', 'anxiety', 'thunder', 'seven', 'reduce', 'express', 'bench', 'inflict', 'sunny', 'slot', 'brand', 'casino', 'blast', 'spatial', 'chunk', 'shallow', 'clarify', 'dish', 'trumpet', 'focus', 'original', 'width', 'divide', 'judge', 'hope', 'wrist', 'response', 'disagree', 'citizen', 'inject', 'gain', 'have', 'rug', 'garage', 'tourist', 'next', 'combine', 'tail', 'furnace', 'argue', 'coil', 'slender', 'canal', 'siege', 'arrive', 'curious', 'doll', 'fog', 'verb', 'skin', 'detect', 'song', 'penalty', 'fade', 'very', 'combine', 'dry', 'gain', 'inherit', 'brother', 'leave', 'law', 'spray', 'mean', 'face', 'barely', 'grid', 'wear', 'ocean', 'pyramid', 'farm', 'mixed', 'crime', 'glance', 'spirit', 'little', 'crane']
`

##### Первичный ключ
Образуется склеиванием пин-кода с самим собой до получения длины равной кол-ву слов в сид фразе минус 1. Ниже будет ясно почему меньше на единицу.
В этом пример длина пин-кода 6 символов. Поэтому мы _добиваем_ еще 5 символов из начала пин-кода к его концу.
Таким образом первичный ключ тумана 12345612345, всего 11 символов.

##### Генерируем ключ тумана

Первичный ключ выглядит так. __К__ это контрольный символ, его расчитаем позже.
| 0  | 1  |  2 | 3  | 4  |  5 | 6  | 7  | 8  | 9  | 10  | К |
|---|---|---|---|---|---|---|---|---|---|---|---|
|  1 | 2  | 3  | 4  | 5  | 6  | 1  | 2  | 3  | 4  | 5  |  |

Теперь, каждый цифру первичного ключа имеющую четный индекс складываем с индексом умноженным на 10.
Каждую цифру первичного ключа имеющую нечетный индекс возводим в квадрат.
Если полученный результат уже присутствует в предыдущих значениях, умножаем его на 2. 
Если это уникальное значение, то оставляем как есть.

Получаем такой вид ключа тумана.
| 0  | 1  |  2 | 3  | 4  |  5 | 6  | 7  | 8  | 9  | 10  | К |
|---|---|---|---|---|---|---|---|---|---|---|---|
|  1 | 2  | 3  | 4  | 5  | 6  | 1  | 2  | 3  | 4  | 5  |  |
|  1 | 4  | 23 | 16  | 45  | 36  | 61  | 8  | 83  | 32  |105  |  |

Контрольный символ вычисляется как остаток от деления суммы всех цифр ключа на кол-во цифр в ключе.
В нашем случае 1+4+23+16+45+36+61+8+83+32+105 = 414. Остаток деления 414 % 11 = 7

Мы получили ключ тумана.
| 0  | 1  |  2 | 3  | 4  |  5 | 6  | 7  | 8  | 9  | 10  | К |
|---|---|---|---|---|---|---|---|---|---|---|---|
|  1 | 2  | 3  | 4  | 5  | 6  | 1  | 2  | 3  | 4  | 5  |  |
|  1 | 4  | 23 | 16  | 45  | 36  | 61  | 8  | 83  | 32  |105  | 7 |


#### Создание публичного тумана
_Для генерации тумана лучше использовать программу, ибо делать это руками будет достаточно неудобно)_
После генерации первичного тумана из случайных слов (выше), записываем нашу сид фразу в туман таким образом:
1. Преобразуем первичный туман в список (_для Pyhon_)
2. Берем последний символ ключа тумана (_обратный цикл_). Его индекс 11, а значение 7.
3. Берем из сид фразы слово стоящее под номер 11 и добавляем его в туман с индексом 7.
4. Туман увеличивается на одно слово, а старые индексы смещаются.
5. Повторяем шаги 3-4 до перебора всей длины ключа.
6. Таким образом, полученный список увеличится на 12 слов.
7. Преобразуем список в строку и полученный набор слов можно распечать, сохранить на компьютере и т.д.



#### Итоговый туман, после полного прохода
`
['mystery', '1', 'base', 'lens', 'smile', '2', 'amazing', 'limit', 'offer', '12', '8', 'column', 'habit', 'art', 'height', 'august', 'emerge', 'merge', '4', 'globe', 'rely', 'boy', 'fan', 'rubber', 'mask', '3', 'salon', 'village', 'lobster', 'physical', 'carbon', 'day', 'tool', 'abuse', 'cruise', 'margin', 'sausage', '10', 'victory', 'open', '6', 'monster', 'anxiety', 'thunder', 'seven', 'reduce', 'express', 'bench', 'inflict', '5', 'sunny', 'slot', 'brand', 'casino', 'blast', 'spatial', 'chunk', 'shallow', 'clarify', 'dish', 'trumpet', 'focus', 'original', 'width', 'divide', 'judge', 'hope', '7', 'wrist', 'response', 'disagree', 'citizen', 'inject', 'gain', 'have', 'rug', 'garage', 'tourist', 'next', 'combine', 'tail', 'furnace', 'argue', 'coil', 'slender', 'canal', 'siege', 'arrive', 'curious', 'doll', 'fog', '9', 'verb', 'skin', 'detect', 'song', 'penalty', 'fade', 'very', 'combine', 'dry', 'gain', 'inherit', 'brother', 'leave', 'law', 'spray', 'mean', 'face', 'barely', 'grid', 'wear', 'ocean', 'pyramid', 'farm', '11', 'mixed', 'crime', 'glance', 'spirit', 'little', 'crane']
`

#### Восстановление сид фразы из тумана достаточно просто выполнить без компьютера
Теперь цикл уже прямой.
1. Создаем пустой список для записи слов из тумана.
2. Преобразуем строку тумана в список (_для Python_)
3. Создаем снова ключ тумана по пин-коду
4. Берем нулевой индекс ключа. Это 1.
5. Добавляем слово из туманного списка с индексом 1 в список слов. Это первое слово из сид фразы.
6. Из туманного списка удаляется элемент с индексом 1. Туман слов укорачивается, индексы смещаются.
7. Шаги 3-5 повторяются до перебора всей длины ключа.

